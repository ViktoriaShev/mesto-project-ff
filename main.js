(()=>{"use strict";function t(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",o),t.addEventListener("click",n)}function e(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o),t.removeEventListener("click",n)}function n(t){t.target.closest(".popup__content")||(t.preventDefault(),e(document.querySelector(".popup_is-opened")))}function o(t){"Escape"===t.key&&(t.preventDefault(),e(document.querySelector(".popup_is-opened")))}var r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-4",headers:{authorization:"74dd0d65-9856-4f64-bb86-97d9403b4cb0","Content-Type":"application/json"}};function a(t){return Promise.reject("Ошибка: ".concat(t))}var i=fetch("".concat(r.baseUrl,"/users/me"),{method:"GET",headers:r.headers}).then((function(t){return t.ok?t.json():a(t.status)})),c=fetch("".concat(r.baseUrl,"/cards"),{method:"GET",headers:r.headers}).then((function(t){return t.ok?t.json():a(t.status)})),u=function(t){return fetch("".concat(r.baseUrl,"/cards/")+t,{method:"DELETE",headers:r.headers}).then((function(t){return t.ok?t.json():a(t.status)}))},s=function(t){return fetch("".concat(r.baseUrl,"/cards/likes/")+t,{method:"PUT",headers:r.headers}).then((function(t){return t.ok?t.json():a(t.status)}))},l=function(t){return fetch("".concat(r.baseUrl,"/cards/likes/")+t,{method:"DELETE",headers:r.headers}).then((function(t){return t.ok?t.json():a(t.status)}))},p=document.querySelector("#card-template").content,d=document.querySelector(".delete__popup"),f=d.querySelector(".popup__button");function _(n,o){var r=n.target.closest(".card");t(d),f.addEventListener("click",(function(t){f.textContent="Удаление...",u(o._id).then((function(t){r.remove(),e(d)})).catch((function(t){console.log(t)})).finally((function(t){f.textContent="Да"}))}))}function m(t,e,n){t.target.classList.contains("card__like-button_is-active")?l(e.informationCard._id).then((function(e){n.textContent=""+e.likes.length,t.target.classList.toggle("card__like-button_is-active")})).catch((function(t){console.log(t)})):s(e.informationCard._id).then((function(e){n.textContent=""+e.likes.length,t.target.classList.toggle("card__like-button_is-active")})).catch((function(t){console.log(t)}))}var y=function(t,e,n,o){var r=t.querySelector(".input_".concat(e.name,"-error"));e.classList.add(o),r.textContent=n},v=function(t,e,n){t.querySelector(".input_".concat(e.name,"-error")).textContent="",e.classList.remove(n)};function h(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?v(t,e,n):y(t,e,e.validationMessage,n)}function b(t,e,n){S(e,n),e.forEach((function(o){v(t,o),o.removeEventListener("input",(function(r){h(t,o),S(e,n)}))}))}var S=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"popup__button_disabled";!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(""+n),e.removeAttribute("disabled","")):(e.setAttribute("disabled",""),e.classList.add(""+n))},q=/http.*(jpeg|jpg|gif|png)/gi,g=document.querySelector(".places__list"),k=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),E=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__add-button"),x=document.querySelector(".profile__image"),A=document.querySelector(".popup_type_edit"),j=document.querySelector(".popup_type_new-card"),U=document.querySelector(".popup_type_image"),P=document.querySelector(".popup_type_edit_avatar"),T=document.querySelectorAll(".popup__close"),w=U.querySelector(".popup__image"),D=U.querySelector(".popup__caption"),M=A.querySelector(".popup__form[name='edit-profile']"),F=j.querySelector(".popup__form[name='new-place']"),I=P.querySelector(".popup__form[name='edit-avatar']"),N=Array.from(document.querySelectorAll(".popup__form")),O=Array.from(M.querySelectorAll(".popup__input")),B=Array.from(F.querySelectorAll(".popup__input")),J=Array.from(I.querySelectorAll(".popup__input")),z=M.querySelector(".popup__input_type_name"),G=M.querySelector(".popup__input_type_description"),H=F.querySelector(".popup__input_type_card-name"),V=F.querySelector(".popup__input_type_url"),K=M.querySelector(".popup__button"),Q=F.querySelector(".popup__button"),R=I.querySelector(".popup__button"),W=[i,c];function X(t){return function(t,e,n,o){var r=t.informationCard,a=p.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__like-button"),c=a.querySelector(".card__image"),u=a.querySelector(".like__counter"),s=""+r.likes.length;u.textContent=s,c.src=r.link,c.alt=r.name,a.querySelector(".card__title").textContent=r.name;var l=a.querySelector(".card__delete-button");return r.owner._id===t.informationMe._id?l.addEventListener("click",(function(t){e(t,r)})):l.remove(),r.likes.forEach((function(e){e._id===t.informationMe._id&&i.classList.add("card__like-button_is-active")})),i.addEventListener("click",(function(e){n(e,t,u)})),c.addEventListener("click",(function(t){o(t)})),a}(t,_,m,Y)}function Y(e){w.src=e.target.src,w.alt=e.target.alt,D.textContent=e.target.alt,t(U)}E.addEventListener("click",(function(e){z.value=k.textContent,G.value=C.textContent,t(A),b(M,O,K)})),L.addEventListener("click",(function(e){F.reset(),b(F,B,Q),t(j)})),x.addEventListener("click",(function(e){b(I,J,R),t(P)})),T.forEach((function(t){t.addEventListener("click",(function(t){e(t.target.closest(".popup"))}))})),M.addEventListener("submit",(function(t){!function(t,n){var o;t.preventDefault(),K.textContent="Сохранение...",(o={name:z.value,job:G.value},fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:o.name,about:o.job})}).then((function(t){return t.ok?t.json():a(t.status)}))).then((function(t){k.textContent=t.name,C.textContent=t.about,e(A)})).catch((function(t){console.log(t)})).finally((function(t){K.textContent="Сохранить"}))}(t)})),F.addEventListener("submit",(function(t){!function(t,e,n){var o;Q.textContent="Сохранение...",t.preventDefault(),(o={dataCard:{name:H.value,link:V.value,likes:[]}},fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({link:o.dataCard.link,name:o.dataCard.name})}).then((function(t){return t.ok?t.json():a(t.status)}))).then((function(t){var n;n=X({informationCard:t,informationMe:dataUserInfo}),g.prepend(n),e(j)})).catch((function(t){console.log(t)})).finally((function(t){Q.textContent="Создать"}))}(t,e)})),I.addEventListener("submit",(function(t){!function(t,n){t.preventDefault(),R.textContent="Сохранение...";var o=n.querySelector(".popup__input_type_url");(function(t){return fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"74dd0d65-9856-4f64-bb86-97d9403b4cb0","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(t){return t.ok?t.json():a(t.status)}))})(o.value).then((function(t){x.setAttribute("style","background-image: url(".concat(t.avatar,")")),o.value="",e(P)})).catch((function(t){console.log(t)})).finally((function(t){R.textContent="Сохранить"}))}(t,I)})),N.forEach((function(t){var e;e={formSelector:t,inputListFormProfile:Array.from(t.querySelectorAll(".popup__input")),buttonSubmit:t.querySelector(".popup__button"),inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},S(e.inputListFormProfile,e.buttonSubmit,e.inactiveButtonClass),e.inputListFormProfile.forEach((function(t){t.addEventListener("input",(function(n){h(e.formSelector,t,e.inputErrorClass),S(e.inputListFormProfile,e.buttonSubmit,e.inactiveButtonClass)}))}))})),Promise.all(W).then((function(t){window.dataUserInfo=t[0],function(t){k.textContent=t.name,C.textContent=t.about,x.setAttribute("style","background-image: url(".concat(t.avatar,")"))}(dataUserInfo),function(t){t.forEach((function(t){if(q.test(t.link)){var e=X({informationCard:t,informationMe:dataUserInfo});g.append(e)}}))}(t[1])})).catch((function(t){console.log(t)}))})();