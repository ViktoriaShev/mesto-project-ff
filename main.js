(()=>{"use strict";function t(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",o),t.addEventListener("click",n)}function e(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o),t.removeEventListener("click",n)}function n(t){t.target.closest(".popup__content")||(t.preventDefault(),e(document.querySelector(".popup_is-opened")))}function o(t){"Escape"===t.key&&(t.preventDefault(),e(document.querySelector(".popup_is-opened")))}var r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-4",headers:{authorization:"74dd0d65-9856-4f64-bb86-97d9403b4cb0","Content-Type":"application/json"}},c=new Promise((function(t,e){fetch("https://nomoreparties.co/v1/wff-cohort-4/users/me",{method:"GET",headers:r.headers}).then((function(e){e.ok&&t(e.json())})).catch((function(t){e("Ошибка: ".concat(t.status))}))})),u=new Promise((function(t,e){fetch("https://nomoreparties.co/v1/wff-cohort-4/cards",{method:"GET",headers:r.headers}).then((function(e){e.ok&&t(e.json())})).catch((function(t){e("Ошибка: ".concat(t.status))}))})),a=function(t){return fetch("https://nomoreparties.co/v1/wff-cohort-4/cards/"+t,{method:"DELETE",headers:r.headers}).then((function(t){if(t.ok)return t.json()})).catch((function(t){return"Ошибка: ".concat(t.status)}))},i=function(t){return fetch("https://nomoreparties.co/v1/wff-cohort-4/cards/likes/"+t,{method:"PUT",headers:r.headers}).then((function(t){return t.json()})).catch((function(t){return"Ошибка: ".concat(t.status)}))},s=function(t){return fetch("https://nomoreparties.co/v1/wff-cohort-4/cards/likes/"+t,{method:"DELETE",headers:r.headers}).then((function(t){return t.json()})).catch((function(t){return"Ошибка: ".concat(t.status)}))},p=document.querySelector("#card-template").content;function l(n,o){var r=n.target.closest(".card"),c=document.querySelector(".delete__popup"),u=c.querySelector(".popup__button");t(c),u.addEventListener("click",(function(t){u.textContent="Удаление...",a(o._id).then((function(t){r.remove(),e(c),u.textContent="Да"})).catch((function(t){return"Ошибка: ".concat(t.status)}))}))}function d(t,e,n){t.target.classList.contains("card__like-button_is-active")?s(e.informationCard._id).then((function(t){n.textContent=""+t.likes.length})).catch((function(t){console.log("Ошибка: ".concat(t.status))})):i(e.informationCard._id).then((function(t){n.textContent=""+t.likes.length})),t.target.classList.toggle("card__like-button_is-active")}var f=function(t,e,n){var o=t.querySelector(".input_".concat(e.name,"-error"));e.classList.add("popup__input_type_error"),o.textContent=n},_=function(t,e){t.querySelector(".input_".concat(e.name,"-error")).textContent="",e.classList.remove("popup__input_type_error")};function m(t,e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?_(t,e):f(t,e,e.validationMessage)}function h(t,e,n){y(e,n),e.forEach((function(o){_(t,o),o.removeEventListener("input",(function(r){m(t,o),y(e,n)}))}))}var v,y=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"popup__button_disabled";!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(""+n),e.removeAttribute("disabled","")):(e.setAttribute("disabled",""),e.classList.add(""+n))},S=/http.*(jpeg|jpg|gif|png)/gi,b=document.querySelector(".places__list"),q=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),g=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__image"),L=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_type_new-card"),A=document.querySelector(".popup_type_image"),w=document.querySelector(".popup_type_edit_avatar"),j=document.querySelectorAll(".popup__close"),T=A.querySelector(".popup__image"),D=A.querySelector(".popup__caption"),P=L.querySelector(".popup__form[name='edit-profile']"),M=x.querySelector(".popup__form[name='new-place']"),N=w.querySelector(".popup__form[name='edit-avatar']"),O=Array.from(document.querySelectorAll(".popup__form")),B=Array.from(P.querySelectorAll(".popup__input")),J=Array.from(M.querySelectorAll(".popup__input")),z=Array.from(N.querySelectorAll(".popup__input")),G=P.querySelector(".popup__input_type_name"),H=P.querySelector(".popup__input_type_description"),U=M.querySelector(".popup__input_type_card-name"),V=M.querySelector(".popup__input_type_url"),F=P.querySelector(".popup__button"),I=M.querySelector(".popup__button"),K=N.querySelector(".popup__button");function Q(t){return function(t,e,n,o){var r=t.informationCard,c=p.querySelector(".card").cloneNode(!0),u=c.querySelector(".card__like-button"),a=c.querySelector(".card__image"),i=c.querySelector(".like__counter"),s=""+r.likes.length;i.textContent=s,a.src=r.link,a.alt=r.name,c.querySelector(".card__title").textContent=r.name;var l=c.querySelector(".card__delete-button");return r.owner._id===t.informationMe._id?l.addEventListener("click",(function(t){e(t,r)})):l.remove(),r.likes.forEach((function(e){e._id===t.informationMe._id&&u.classList.add("card__like-button_is-active")})),u.addEventListener("click",(function(e){n(e,t,i)})),a.addEventListener("click",(function(t){o(t)})),c}(t,l,d,R)}function R(e){T.src=e.target.src,T.alt=e.target.alt,D.textContent=e.target.alt,t(A)}g.addEventListener("click",(function(e){G.value=q.textContent,H.value=C.textContent,t(L),h(P,B,F)})),k.addEventListener("click",(function(e){h(M,J,I),t(x)})),E.addEventListener("click",(function(e){t(w)})),j.forEach((function(t){t.addEventListener("click",(function(t){e(t.target.closest(".popup"))}))})),P.addEventListener("submit",(function(t){!function(t,n){var o;t.preventDefault(),F.textContent="Сохранение...",(o={name:G.value,job:H.value},fetch("https://nomoreparties.co/v1/wff-cohort-4/users/me",{method:"PATCH",headers:r.headers,body:JSON.stringify({name:o.name,about:o.job})}).then((function(t){return t.json()})).catch((function(t){return"Ошибка: ".concat(t.status)}))).then((function(t){q.textContent=t.name,C.textContent=t.about})).catch((function(t){return"Ошибка: ".concat(t.status)})).finally((function(t){e(L),F.textContent="Сохранить"})),h(P,B,F),h(n,B,F)}(t,P)})),M.addEventListener("submit",(function(t){!function(t,e,n){var o;I.textContent="Сохранение...",t.preventDefault(),(o={dataCard:{name:U.value,link:V.value,likes:[]},myData:c},fetch("https://nomoreparties.co/v1/wff-cohort-4/cards",{method:"POST",headers:r.headers,body:JSON.stringify({link:o.dataCard.link,name:o.dataCard.name})}).then((function(t){return t.json()})).catch((function(t){return"Ошибка: ".concat(t.status)}))).then((function(t){var n,o;n=t,o=[c,u],Promise.all(o).then((function(t){var e=Q({informationCard:n,informationMe:t[0]});b.prepend(e)})).catch((function(t){console.log(t)})),e(x)})).catch((function(t){console.log("Ошибка: ".concat(t.status))})).finally((function(t){I.textContent="Создать",h(n,J,I),U.value="",V.value=""}))}(t,e,M)})),N.addEventListener("submit",(function(t){!function(t,n){t.preventDefault(),K.textContent="Сохранение...";var o=n.querySelector(".popup__input_type_url");(function(t){return fetch("https://nomoreparties.co/v1/wff-cohort-4/users/me/avatar",{method:"PATCH",headers:{authorization:"74dd0d65-9856-4f64-bb86-97d9403b4cb0","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(t){return t.json()})).catch((function(t){return"Ошибка: ".concat(t.status)}))})(o.value).then((function(t){E.setAttribute("style","background-image: url(".concat(t.avatar,")")),o.value=""})).catch((function(t){return"Ошибка: ".concat(t.status)})).finally((function(t){h(n,z,K),K.textContent="Сохранить",e(w)}))}(t,N)})),v=[c,u],Promise.all(v).then((function(t){!function(t){q.textContent=t.name,C.textContent=t.about,E.setAttribute("style","background-image: url(".concat(t.avatar,")"))}(t[0]),function(t){t[1].forEach((function(e){if(S.test(e.link)){var n=Q({informationCard:e,informationMe:t[0]});b.append(n)}}))}(t)})).catch((function(t){console.log(t)})),O.forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t){var e=Array.from(t.formSelector.querySelectorAll(".popup__input")),n=t.formSelector.querySelector(".popup__button");y(e,n,t.inactiveButtonClass),e.forEach((function(o){o.addEventListener("input",(function(r){m(t.formSelector,o),y(e,n,t.inactiveButtonClass)}))}))}({formSelector:t,inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})}))})();